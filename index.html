<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>مصحف التجويد - النسخة المصححة</title>
    <script src="https://unpkg.com/page-flip@2.0.7/dist/js/page-flip.browser.js"></script>
    <style>
        :root { --bg: #000; --gold: #d4af37; --paper: #ffffff; }
        body { background: var(--bg); margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; font-family: sans-serif; overflow: hidden; }

        /* شريط علوي نحيف وثابت */
        .navbar { 
            width: 100%; background: #151515; height: 55px;
            display: flex; justify-content: space-between; align-items: center; 
            padding: 0 10px; box-sizing: border-box; z-index: 9999; border-bottom: 1px solid var(--gold);
        }

        .info { color: var(--gold); font-size: 13px; font-weight: bold; min-width: 100px; }
        .theme-btns { display: flex; gap: 8px; }
        .t-btn { width: 22px; height: 22px; border-radius: 50%; border: 1px solid #444; cursor: pointer; }

        /* منطقة العرض - محددة الارتفاع لمنع الطيران */
        .viewport { flex: 1; display: flex; justify-content: center; align-items: center; padding: 5px; background: #080808; }
        #book-frame { width: 100%; height: 85vh; max-width: 900px; display: flex; justify-content: center; }

        .page { width: 100%; height: 100%; background: var(--paper); display: flex; align-items: center; justify-content: center; }
        
        /* قفل أبعاد الصورة: هذا هو سر استقرار التصميم */
        .page img { 
            max-width: 98%; max-height: 98%; 
            width: auto; height: auto;
            object-fit: contain; background: var(--paper); pointer-events: none;
        }

        .btn-ui { background: #222; color: #fff; border: 1px solid var(--gold); padding: 4px 10px; border-radius: 4px; font-size: 12px; cursor: pointer; }
        select { background: #222; color: #fff; border: 1px solid var(--gold); padding: 4px; border-radius: 4px; width: 120px; font-size: 12px; }
    </style>
</head>
<body>

<div class="navbar">
    <div class="info">
        <div id="cur-surah">المصحف الشريف</div>
        <div id="cur-page" style="color:#777; font-size:10px;">صفحة: 0</div>
    </div>

    <div class="theme-btns">
        <div class="t-btn" style="background:#ffffff;" onclick="setTheme('#ffffff')"></div>
        <div class="t-btn" style="background:#f4ecd8;" onclick="setTheme('#f4ecd8')"></div>
        <div class="t-btn" style="background:#e0e0e0;" onclick="setTheme('#e0e0e0')"></div>
    </div>

    <div style="display:flex; gap:5px;">
        <button class="btn-ui" onclick="pageFlip.flipNext()">السابق</button>
        <button class="btn-ui" onclick="pageFlip.flipPrev()">التالي</button>
    </div>

    <select id="surah-select" onchange="go(this.value)">
        <option value="">اختر السورة..</option>
    </select>
</div>

<div class="viewport">
    <div id="book-frame">
        <div id="quran-book"></div>
    </div>
</div>

<script>
    let pageFlip;
    // الفهرس الدقيق (تم التأكد من أرقام الصفحات حسب طبعة المدينة)
    const suras = [
        {n:"الفاتحة", p:1}, {n:"البقرة", p:2}, {n:"آل عمران", p:50}, {n:"النساء", p:77}, {n:"المائدة", p:106}, {n:"الأنعام", p:128}, {n:"الأعراف", p:151}, {n:"الأنفال", p:177}, {n:"التوبة", p:187}, {n:"يونس", p:208}, {n:"هود", p:221}, {n:"يوسف", p:235}, {n:"الرعد", p:249}, {n:"إبراهيم", p:255}, {n:"الحجر", p:262}, {n:"النحل", p:267}, {n:"الإسراء", p:282}, {n:"الكهف", p:293}, {n:"مريم", p:305}, {n:"طه", p:312}, {n:"الأنبياء", p:322}, {n:"الحج", p:332}, {n:"المؤمنون", p:342}, {n:"النور", p:350}, {n:"الفرقان", p:359}, {n:"الشعراء", p:367}, {n:"النمل", p:377}, {n:"القصص", p:385}, {n:"العنكبوت", p:396}, {n:"الروم", p:404}, {n:"لقمان", p:411}, {n:"السجدة", p:415}, {n:"الأحزاب", p:418}, {n:"سبأ", p:428}, {n:"فاطر", p:434}, {n:"يس", p:440}, {n:"الصافات", p:446}, {n:"ص", p:453}, {n:"الزمر", p:458}, {n:"غافر", p:467}, {n:"فصلت", p:477}, {n:"الشورى", p:483}, {n:"الزخرف", p:489}, {n:"الدخان", p:496}, {n:"الجاثية", p:499}, {n:"الأحقاف", p:502}, {n:"محمد", p:507}, {n:"الفتح", p:511}, {n:"الحجرات", p:515}, {n:"ق", p:518}, {n:"الذاريات", p:520}, {n:"الطور", p:523}, {n:"النجم", p:526}, {n:"القمر", p:528}, {n:"الرحمن", p:531}, {n:"الواقعة", p:534}, {n:"الحديد", p:537}, {n:"المجادلة", p:542}, {n:"الحشر", p:545}, {n:"الممتحنة", p:549}, {n:"الصف", p:551}, {n:"الجمعة", p:553}, {n:"المنافقون", p:554}, {n:"التغابن", p:556}, {n:"الطلاق", p:558}, {n:"التحريم", p:560}, {n:"الملك", p:562}, {n:"القلم", p:564}, {n:"الحاقة", p:566}, {n:"المعارج", p:568}, {n:"نوح", p:570}, {n:"الجن", p:572}, {n:"المزمل", p:574}, {n:"المدثر", p:575}, {n:"القيامة", p:577}, {n:"الإنسان", p:578}, {n:"المرسلات", p:580}, {n:"النبأ", p:582}, {n:"النازعات", p:583}, {n:"عبس", p:585}, {n:"التكوير", p:586}, {n:"الانفطار", p:587}, {n:"المطففين", p:587}, {n:"الانشقاق", p:589}, {n:"البروج", p:590}, {n:"الطارق", p:591}, {n:"الأعلى", p:591}, {n:"الغاشية", p:592}, {n:"الفجر", p:593}, {n:"البلد", p:594}, {n:"الشمس", p:595}, {n:"الليل", p:595}, {n:"الضحى", p:596}, {n:"الشرح", p:596}, {n:"التين", p:597}, {n:"العلق", p:597}, {n:"القدر", p:598}, {n:"البينة", p:598}, {n:"الزلزلة", p:599}, {n:"العاديات", p:599}, {n:"القارعة", p:600}, {n:"التكاثر", p:600}, {n:"العصر", p:601}, {n:"الهمزة", p:601}, {n:"الفيل", p:601}, {n:"قريش", p:602}, {n:"الماعون", p:602}, {n:"الكوثر", p:602}, {n:"الكافرون", p:603}, {n:"النصر", p:603}, {n:"المسد", p:603}, {n:"الإخلاص", p:604}, {n:"الفلق", p:604}, {n:"الناس", p:604}
    ];

    window.onload = function() {
        const book = document.getElementById('quran-book');
        const sel = document.getElementById('surah-select');
        suras.forEach(s => sel.add(new Option(s.n, s.p)));

        for (let i = 0; i <= 604; i++) {
            const page = document.createElement('div');
            page.className = 'page';
            const img = document.createElement('img');
            img.src = i.toString().padStart(3, '0') + ".webp"; 
            page.appendChild(img);
            book.appendChild(page);
        }

        pageFlip = new St.PageFlip(book, {
            width: 450, height: 650,
            size: "stretch",
            showCover: true,
            drawShadow: true,
            direction: 'rtl',
            usePortrait: window.innerWidth < 800,
            clickEventForward: false,
            useMouseEvents: true
        });

        pageFlip.loadFromHTML(document.querySelectorAll('.page'));

        pageFlip.on('flip', (e) => {
            const p = e.data; 
            document.getElementById('cur-page').innerText = "صفحة: " + p;
            const s = suras.filter(x => x.p <= p).slice(-1)[0];
            document.getElementById('cur-surah').innerText = s ? "سورة " + s.n : "غلاف المصحف";
        });
    };

    function setTheme(color) {
        document.querySelectorAll('.page, .page img').forEach(el => el.style.backgroundColor = color);
    }

    function go(p) {
        if(p) pageFlip.turnToPage(parseInt(p));
    }
</script>
</body>
</html>